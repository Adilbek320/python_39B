define(["jquery","Magento_Customer/js/customer-data"],function($,customerData){"use strict";$.widget("mage.bounteous_datalayer",{options:{selectors:{product:".product-items > .product-item",productLink:".catalog-category-view .product-item a",relatedProduct:".products-related .product-item",relatedProductLink:".products-related .product-item a",upsellProduct:".products-upsell .product-item",upsellProductLink:".products-upsell .product-item a",crossSellProduct:".products-crosssell .product-item",crossSellProductLink:".products-crosssell .product-item a",},},_create:function(){var self=this;window.dataLayer=window.dataLayer||[];self.dataLayer=window.dataLayer;this._fireEvents();this._bindEvents();},_fireEvents:function(){var events=this.options.events||{};if(events["dl-ready"]){this._fireEvent(events["dl-ready"]);}
if(events["view_cart"]){this._fireEvent(events["view_cart"]);}
if(events["begin_checkout"]){this._fireEvent(events["begin_checkout"]);}
if(events["view_item"]){this._fireEvent(events["view_item"]);}
if(events["view_item_list"]){this._fireEvent(events["view_item_list"]);}
if(events["view_related_products"]){this._fireEvent(events["view_related_products"]);}
if(events["view_upsell_products"]){this._fireEvent(events["view_upsell_products"]);}
if(events["view_cross_sell_products"]){this._fireEvent(events["view_cross_sell_products"]);}
if(events["purchase"]){this._fireEvent(events["purchase"]);}},_bindEvents:function(){var self=this,DataLayer=customerData.get("bounteous_datalayer"),selectors=self.options.selectors,product=selectors.product,productLink=selectors.productLink,relatedProduct=selectors.relatedProduct,relatedLink=selectors.relatedProductLink,upsellProduct=selectors.upsellProduct,upsellLink=selectors.upsellProductLink,crossSellProduct=selectors.crossSellProduct,crossSellLink=selectors.crossSellProductLink,allProducts=$(product);$(document).on("click",productLink,function(e){var closestProduct=$(this).closest(product),clickedIndex=allProducts.index(closestProduct);self._handleSelectItem(clickedIndex);});$(document).on("click",relatedLink,function(e){var closestProduct=$(this).closest(product),index=$(relatedProduct).index(closestProduct);self._handleSelectRelated(index);});$(document).on("click",upsellLink,function(e){var closestProduct=$(this).closest(product),index=$(upsellProduct).index(closestProduct);self._handleSelectUpsell(index);});$(document).on("click",crossSellLink,function(e){e.preventDefault();var closestProduct=$(this).closest(product),index=$(crossSellProduct).index(closestProduct);self._handleSelectCrossSell(index);});DataLayer.subscribe(function(data){if(data.add_to_cart){self._fireEvent(data.add_to_cart);}
if(data.remove_from_cart){self._fireEvent(data.remove_from_cart);}
if(data.add_to_wishlist){self._fireEvent(data.add_to_wishlist);}}.bind(this));},_fireEvent:function(eventData){var self=this;self.dataLayer.push({ecommerce:null});return self.dataLayer.push(eventData);},_handleSelectItem:function(index){var self=this,productData=self.options.products[index],event=self.options.events.select_item;event.ecommerce.items=[];if(productData){event.ecommerce.items.push(productData);self._fireEvent(event);}},_handleSelectRelated:function(index){var self=this,productData=self.options.related_products[index],event=self.options.events.select_item;event.ecommerce.items=[];event.ecommerce.item_list_name="Related Products";if(productData){event.ecommerce.item_list_id=productData.item_id;event.ecommerce.items.push(productData);self._fireEvent(event);}},_handleSelectUpsell:function(index){var self=this,productData=self.options.upsell_products[index],event=self.options.events.select_item;event.ecommerce.items=[];event.ecommerce.item_list_name="Upsell Products";if(productData){event.ecommerce.item_list_id=productData.item_id;event.ecommerce.items.push(productData);self._fireEvent(event);}},_handleSelectCrossSell:function(index){var self=this,productData=self.options.cross_sell_products[index],event=self.options.events.select_item;event.ecommerce.items=[];event.ecommerce.item_list_name="Cross-Sell Products";if(productData){event.ecommerce.items.push(productData);self._fireEvent(event);}},});return $.mage.bounteous_datalayer;});