define(["jquery"],function($){"use strict";$.widget("custom.navigation",{options:{config:{},categories:[],trigger:".nav-link",headerIcon:".header-icon",accountIcon:".header-icon--account",activeLink:".nav-link.active",activeDropdown:".dropdown.active",links:document.querySelectorAll(".nav-link"),dropdowns:document.querySelectorAll(".dropdown"),container:document.getElementById("dropdown_container"),},_create:function(){var self=this;self._bindEvents();},_bindEvents:function(){var self=this,icon=self.options.headerIcon,account=self.options.accountIcon,trigger=self.options.trigger;$(document).on("click",trigger,self._handleClick.bind(self));$(document).on("click",account,self._toggleAccount.bind(self));$(document).on("mouseover",trigger,self._showDropdown.bind(self));$(document).on("click",icon,self._reset.bind(self));$(document).on("dropdowndialogopen",self._minicartOpen.bind(self));$(document).on("dropdowndialogclose",self._minicartClose.bind(self));var debounceReset=self._debounce(function(e){var isInsideDropdown=e.target.closest(".dropdown-container");var isInsideHeader=e.target.closest(".cokestore-header");if(!isInsideDropdown&&!isInsideHeader){self._reset();}},100);document.addEventListener("mouseover",debounceReset);var onResize=self._debounce(function(){self._getDropdownsConfig();},250);window.addEventListener("resize",onResize);document.addEventListener("click",function(event){if(!event.target.closest(".header-icon--account")){$(".header-icon--account").removeClass("active");$(".account-menu").removeClass("active");}});},_reset:function(){var self=this,links=self.options.activeLink,dropdowns=self.options.activeDropdown,container=self.options.container;$(links).removeClass("active");$(dropdowns).removeClass("active");$(container).removeClass("active");},_debounce:function(func,delay){var timeout;return function(){var context=this;var args=arguments;clearTimeout(timeout);timeout=setTimeout(function(){func.apply(context,args);},delay);};},_getDropdownsConfig:function(){var self=this;self.options.links.forEach(function(link){self.options.categories.push(link.dataset.id);});self.options.dropdowns.forEach(function(dropdown){var id=dropdown.dataset.id,size=self._getSize(dropdown),position=self._getPosition(id),dropdownConfig={x:position.x,y:position.y,width:size.width,height:size.height,};self.options.config[id]=dropdownConfig;});},_getSize:function(element){var height=element.getBoundingClientRect().height,blocks=element.querySelectorAll(".nav-block"),calculatedHeight=0;for(var i=0;i<blocks.length;i++){calculatedHeight+=blocks[i].clientHeight;}
var columns=Math.ceil(calculatedHeight / 500);var width=columns*260;return{height:height+40,width:width+40,};},_getPosition:function(id){var rect=document.querySelector(".nav-link[data-id='"+id+"']").getBoundingClientRect();return{x:Math.ceil(rect.left+rect.width / 2),y:Math.ceil(rect.top+rect.height / 2+10),};},_setContainerStyles:function(id){var self=this,config=self.options.config[id],container=self.options.container,left=config.x-config.width / 2,viewport=window.innerWidth,posX=left<0?20:left;if(posX+config.width>viewport){posX=viewport-config.width-20;}
var x=posX+"px",y=config.y+20+"px",translate="translateX("+x+") translateY("+y+")";container.style.width=config.width+"px";container.style.height=config.height+"px";container.style.transform=translate;},_handleClick:function(e){e.preventDefault();},_showDropdown:function(e){var self=this,link=e.target,linkId=link.dataset.id,container=self.options.container,dropdown=document.getElementById("dropdown_"+linkId);self._reset();link.classList.add("active");dropdown.classList.add("active");container.classList.add("active");if(self.options.config&&Object.keys(self.options.config).length===0){self._getDropdownsConfig();}
self._setContainerStyles(linkId);},_minicartOpen:function(){var self=this;self._closeAccount();self._reset();$(".header-icon--cart").addClass("active");},_minicartClose:function(){var self=this;$(".header-icon--cart").removeClass("active");},_toggleAccount:function(){$(".header-icon--account").toggleClass("active");$("#account_menu").toggleClass("active");},_closeAccount:function(){$(".header-icon--account").removeClass("active");$("#account_menu").removeClass("active");},});return $.custom.navigation;});